<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS SOCIAL | Infinite Feed</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.29.0/feather.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-body: #000000;
            --primary: #3b82f6; 
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --nav-height: 70px;
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background: var(--bg-body);
            color: var(--text-main);
            font-family: 'Outfit', sans-serif;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- Header --- */
        .top-bar {
            position: absolute; top: 0; left: 0; width: 100%;
            padding: 15px 20px; z-index: 50;
            display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            pointer-events: none; 
        }
        .app-logo {
            font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 800;
            font-size: 1.2rem; letter-spacing: -0.5px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5); pointer-events: auto;
        }

        /* --- Feed --- */
        #feedView {
            height: 100%; width: 100%;
            overflow-y: scroll; scroll-snap-type: y mandatory;
            scrollbar-width: none; 
        }
        #feedView::-webkit-scrollbar { display: none; }

        .reel-item {
            width: 100%; height: 100vh;
            scroll-snap-align: start; position: relative;
            background: #111; overflow: hidden;
        }

        .reel-video {
            width: 100%; height: 100%; object-fit: cover;
            filter: brightness(0.95);
        }

        /* UI Elements */
        .reel-overlay {
            position: absolute; inset: 0;
            display: flex; flex-direction: column; justify-content: flex-end;
            padding: 20px 20px 90px 20px; 
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, transparent 40%);
            pointer-events: none;
        }

        .user-info-row {
            display: flex; align-items: center; gap: 12px; margin-bottom: 12px; pointer-events: auto;
        }
        .u-avatar {
            width: 42px; height: 42px; border-radius: 50%; border: 2px solid white; object-fit: cover;
        }
        .u-name { font-weight: 700; font-size: 1.1rem; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }
        .follow-btn {
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
            color: white; padding: 4px 12px; border-radius: 20px;
            font-size: 0.75rem; font-weight: 600; backdrop-filter: blur(4px);
        }

        .reel-caption {
            font-size: 0.95rem; line-height: 1.4; max-width: 85%; margin-bottom: 15px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8); pointer-events: auto;
        }

        /* Sidebar Actions */
        .reel-actions {
            position: absolute; right: 15px; bottom: 100px;
            display: flex; flex-direction: column; gap: 20px; align-items: center;
            z-index: 20; pointer-events: auto;
        }

        .action-btn {
            display: flex; flex-direction: column; align-items: center; gap: 6px;
            color: white; font-size: 0.8rem; font-weight: 600;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5); cursor: pointer; transition: transform 0.1s;
        }
        .action-btn:active { transform: scale(0.9); }
        
        .icon-circle {
            width: 45px; height: 45px;
            background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(5px);
            border-radius: 50%; display: grid; place-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Share Bottom Sheet */
        .share-sheet {
            position: fixed; bottom: -100%; left: 0; width: 100%;
            background: #1a1a1a; border-radius: 20px 20px 0 0;
            padding: 25px; z-index: 200; transition: bottom 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        .share-sheet.active { bottom: 0; }
        
        .share-header { text-align: center; margin-bottom: 25px; font-weight: 700; font-size: 1.1rem; color: #fff; }
        
        .share-grid { display: flex; justify-content: space-around; gap: 10px; }
        .share-item {
            display: flex; flex-direction: column; align-items: center; gap: 8px;
            color: #ccc; font-size: 0.8rem; background: none; border: none; cursor: pointer;
        }
        .share-icon-box {
            width: 55px; height: 55px; border-radius: 50%;
            background: #333; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; color: white; transition: 0.2s;
        }
        .share-item:active .share-icon-box { background: var(--primary); transform: scale(0.95); }

        .overlay-bg {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 199;
            display: none; opacity: 0; transition: opacity 0.3s;
        }
        .overlay-bg.active { display: block; opacity: 1; }

        /* Loader */
        .loader-container {
            height: 100vh; display: flex; align-items: center; justify-content: center;
            flex-direction: column; gap: 10px; color: var(--text-muted);
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1);
            border-left-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 100% {transform: rotate(360deg);} }

        /* Toast */
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8); color: white; padding: 12px 24px;
            border-radius: 8px; font-weight: 600; opacity: 0; pointer-events: none; transition: 0.3s; z-index: 300;
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="top-bar">
        <div class="app-logo">NEXUS REELS</div>
    </div>

    <!-- Feed Container -->
    <div id="feedView">
        <div id="feedLoader" class="loader-container">
            <div class="spinner"></div>
            <span>Loading Infinite Feed...</span>
        </div>
        <div id="reelsContainer"></div>
    </div>

    <!-- Share Sheet -->
    <div id="overlay" class="overlay-bg" onclick="closeShare()"></div>
    <div id="shareSheet" class="share-sheet">
        <div class="share-header">Share Reel</div>
        <div class="share-grid">
            <button class="share-item" onclick="handleCopyLink()">
                <div class="share-icon-box" style="background:#222;"><i data-feather="link"></i></div>
                <span>Copy Link</span>
            </button>
            <button class="share-item" onclick="handleDownload()">
                <div class="share-icon-box" style="background:#222;"><i data-feather="download"></i></div>
                <span>Download</span>
            </button>
            <button class="share-item" onclick="handleNativeShare()">
                <div class="share-icon-box" style="background:#25D366;"><i data-feather="share-2"></i></div>
                <span>Share App</span>
            </button>
        </div>
        <button onclick="closeShare()" style="width:100%; padding:15px; background:#333; border:none; color:white; border-radius:12px; margin-top:25px; font-weight:600;">Cancel</button>
    </div>

    <div id="toast" class="toast">Action Complete</div>

    <script>
        feather.replace();

        // --- EXPANDED DATA (More Videos for Infinite Feel) ---
        const STOCK_REELS = [
            {
                url: 'https://videos.pexels.com/video-files/3209828/3209828-hd_720_1280_25fps.mp4',
                thumb: 'https://images.pexels.com/photos/3209828/pexels-photo-3209828.jpeg',
                user: 'travel_vibes', pfp: 'https://images.unsplash.com/photo-1529665253569-6d01c0eaf7b6?w=100',
                likes: '14.5K', comments: '342', cap: 'Sunset drives are the best therapy ðŸŒ…'
            },
            {
                url: 'https://videos.pexels.com/video-files/5818884/5818884-hd_720_1280_25fps.mp4',
                thumb: '', user: 'tech_guru', pfp: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100',
                likes: '8.9K', comments: '120', cap: 'The future of AI is here ðŸ¤– #tech'
            },
            {
                url: 'https://videos.pexels.com/video-files/2795405/2795405-hd_720_1280_25fps.mp4',
                thumb: '', user: 'fitness_pro', pfp: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=100',
                likes: '22K', comments: '890', cap: 'Never skip leg day ðŸ‹ï¸â€â™‚ï¸ #gym'
            },
            {
                url: 'https://videos.pexels.com/video-files/3632598/3632598-hd_720_1280_30fps.mp4',
                thumb: '', user: 'foodie_heaven', pfp: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100',
                likes: '5.6K', comments: '90', cap: 'Pasta goals ðŸ #foodie'
            },
            {
                url: 'https://videos.pexels.com/video-files/4114797/4114797-hd_720_1280_30fps.mp4',
                thumb: '', user: 'cat_lovers', pfp: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=100',
                likes: '102K', comments: '5K', cap: 'Look at this little guy! ðŸ±'
            },
            {
                url: 'https://videos.pexels.com/video-files/3009941/3009941-hd_720_1280_25fps.mp4',
                thumb: '', user: 'ocean_life', pfp: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100',
                likes: '45K', comments: '1.2K', cap: 'Deep blue calm ðŸŒŠ #ocean'
            },
            {
                url: 'https://videos.pexels.com/video-files/5532776/5532776-hd_720_1280_25fps.mp4',
                thumb: '', user: 'urban_skate', pfp: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100',
                likes: '12K', comments: '200', cap: 'Night skating in Tokyo ðŸ›¹'
            }
        ];

        let currentActiveUrl = ''; // Stores URL for sharing
        let isMuted = true;

        window.onload = () => {
            initFeed();
            setupInfiniteScroll();
        };

        // --- CORE FEED LOGIC ---
        function initFeed() {
            // First load
            appendReels(STOCK_REELS); 
            document.getElementById('feedLoader').style.display = 'none';
        }

        // --- INFINITE SCROLL LOGIC ---
        function setupInfiniteScroll() {
            const feed = document.getElementById('feedView');
            feed.addEventListener('scroll', () => {
                // If user scrolls near the bottom (within 100px)
                if (feed.scrollTop + feed.clientHeight >= feed.scrollHeight - 100) {
                    addMoreRandomReels();
                }
            });
        }

        function addMoreRandomReels() {
            // Shuffle existing reels to make it look like new content
            const shuffled = [...STOCK_REELS].sort(() => 0.5 - Math.random());
            appendReels(shuffled);
        }

        function appendReels(reels) {
            const container = document.getElementById('reelsContainer');
            reels.forEach((reel, i) => {
                // Unique ID for audio toggle
                const uid = Date.now() + Math.random(); 
                
                const el = document.createElement('div');
                el.className = 'reel-item';
                el.innerHTML = `
                    <video class="reel-video" src="${reel.url}" loop playsinline webkit-playsinline muted poster="${reel.thumb}"></video>
                    
                    <div class="reel-overlay">
                        <div class="user-info-row">
                            <img src="${reel.pfp}" class="u-avatar">
                            <span class="u-name">${reel.user}</span>
                            <button class="follow-btn">Follow</button>
                        </div>
                        <div class="reel-caption">${reel.cap}</div>
                    </div>

                    <div class="reel-actions">
                        <div class="action-btn">
                            <div class="icon-circle"><i data-feather="heart" fill="white" stroke="none"></i></div>
                            <span>${reel.likes}</span>
                        </div>
                        <div class="action-btn">
                            <div class="icon-circle"><i data-feather="message-circle"></i></div>
                            <span>${reel.comments}</span>
                        </div>
                        <!-- NEW SHARE BUTTON -->
                        <div class="action-btn" onclick="openShare('${reel.url}')">
                            <div class="icon-circle"><i data-feather="share-2"></i></div>
                            <span>Share</span>
                        </div>
                        <div class="action-btn" onclick="toggleMuteAll()">
                            <div class="icon-circle mute-icon"><i data-feather="volume-x"></i></div>
                        </div>
                    </div>
                `;
                container.appendChild(el);

                // Play/Pause Click
                const vid = el.querySelector('video');
                el.onclick = (e) => {
                    if(e.target.closest('.reel-actions') || e.target.closest('.user-info-row')) return;
                    vid.paused ? vid.play() : vid.pause();
                };
            });
            feather.replace();
            setupObserver();
        }

        // --- OBSERVER (Auto Play) ---
        function setupObserver() {
            const options = { root: document.getElementById('feedView'), threshold: 0.6 };
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const vid = entry.target.querySelector('video');
                    if(entry.isIntersecting) {
                        vid.play().catch(()=>{});
                    } else {
                        vid.pause();
                    }
                });
            }, options);

            // Observe only new items
            document.querySelectorAll('.reel-item').forEach(el => observer.observe(el));
        }

        // --- SHARE LOGIC ---
        function openShare(url) {
            currentActiveUrl = url;
            document.getElementById('overlay').classList.add('active');
            document.getElementById('shareSheet').classList.add('active');
        }

        function closeShare() {
            document.getElementById('overlay').classList.remove('active');
            document.getElementById('shareSheet').classList.remove('active');
        }

        function handleCopyLink() {
            navigator.clipboard.writeText(currentActiveUrl).then(() => {
                showToast("Link Copied!");
                closeShare();
            });
        }

        function handleDownload() {
            showToast("Downloading...");
            // Direct download trick
            const a = document.createElement('a');
            a.href = currentActiveUrl;
            a.download = `nexus_reel_${Date.now()}.mp4`;
            a.target = "_blank"; // Fallback for mobile
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            closeShare();
        }

        function handleNativeShare() {
            if (navigator.share) {
                navigator.share({
                    title: 'Watch this Reel',
                    text: 'Check out this awesome video on Nexus Social!',
                    url: currentActiveUrl
                }).catch(console.error);
            } else {
                showToast("Share not supported on this browser");
            }
            closeShare();
        }

        // --- AUDIO TOGGLE ---
        function toggleMuteAll() {
            isMuted = !isMuted;
            document.querySelectorAll('video').forEach(v => v.muted = isMuted);
            const icon = isMuted ? 'volume-x' : 'volume-2';
            document.querySelectorAll('.mute-icon').forEach(el => {
                el.innerHTML = `<i data-feather="${icon}"></i>`;
            });
            feather.replace();
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        }

    </script>
</body>
</html>
